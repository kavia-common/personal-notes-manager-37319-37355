{"is_source_file": true, "format": "TypeScript", "description": "This file defines a client-side in-memory store for managing notes in a frontend application. It includes state management, caching, CRUD operations, cache invalidation, and pub/sub mechanisms, interfacing with an API client and WebSocket for real-time updates.", "external_files": ["./api", "./types", "./ws"], "external_methods": ["APIClient.listNotes", "APIClient.getNote", "APIClient.createNote", "APIClient.patchNote", "APIClient.deleteNote", "connectNotesWebSocket"], "published": ["NotesStore", "NotesQuery", "NotesState"], "classes": [{"name": "NotesStoreImpl", "description": "The main class implementing a lightweight in-memory store for notes, supporting subscriptions, caching, and CRUD operations."}], "methods": [{"name": "subscribe", "description": "Subscribe to state changes. Returns an unsubscribe function."}, {"name": "getState", "description": "Get a snapshot of current store state."}, {"name": "setState", "description": "Update the store state with a partial patch and notify subscribers."}, {"name": "loadList", "description": "Fetch and cache a list of notes with optional query parameters."}, {"name": "invalidateList", "description": "Invalidate the cached list of notes, optionally keeping the current query parameters."}, {"name": "loadNote", "description": "Fetch and cache a specific note by id."}, {"name": "create", "description": "Create a new note and update caches accordingly."}, {"name": "update", "description": "Update an existing note and sync caches."}, {"name": "remove", "description": "Remove a note by id and update caches."}, {"name": "toggleFavorite", "description": "Optimistically toggle the favorite status of a note with rollback on failure."}], "calls": ["APIClient.listNotes", "APIClient.getNote", "APIClient.createNote", "APIClient.patchNote", "APIClient.deleteNote", "connectNotesWebSocket"], "search-terms": ["NotesStoreImpl", "client-side cache", "pub/sub", "notes list cache", "notifications", "websocket", "notes CRUD", "state management"], "state": 2, "file_id": 11, "knowledge_revision": 32, "git_revision": "", "revision_history": [{"28": ""}, {"32": ""}], "ctags": [{"_type": "tag", "name": "Listener", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^type Listener = () => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "NotesQuery", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^interface NotesQuery {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "NotesState", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^interface NotesState {$/", "language": "TypeScript", "kind": "interface"}, {"_type": "tag", "name": "NotesStore", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^export const NotesStore = new NotesStoreImpl();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "NotesStoreImpl", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^class NotesStoreImpl {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "currentFav", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const currentFav = fromSelected?.favorite ?? fromList?.favorite ?? false;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "currentParams", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const currentParams = this.state.listParams;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "deletedId", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^      const deletedId = detail?.payload?.id;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "detail", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const detail = (e as CustomEvent).detail as { type?: string; payload?: any } | undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "evtType", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const evtType = detail?.type || '';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "false", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const currentFav = fromSelected?.favorite ?? fromList?.favorite ?? false;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "favorite", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  favorite?: boolean;$/", "language": "TypeScript", "kind": "property", "scope": "NotesQuery", "scopeKind": "interface"}, {"_type": "tag", "name": "fromList", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const currentFav = fromSelected?.favorite ?? fromList?.favorite ?? false;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fromList", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const fromList = this.state.list?.items.find((n) => n.id === id);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fromSelected", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const fromSelected = this.state.selectedId === id ? this.state.selected : undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^        const items = list.items.map((it) =>$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^      const items = list.items.filter((it) => it.id !== id);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^      const items = list.items.map((it) => (it.id === id ? updated : it));$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^      const items = list.items.map((it) =>$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^        const list = this.state.list;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^      const list = this.state.list;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "list", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  list?: Paginated<Note>;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "listError", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  listError?: string;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "listLoading", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  listLoading: boolean;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "listParams", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  listParams?: NotesQuery;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "listeners", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  private listeners = new Set<Listener>();$/", "language": "TypeScript", "kind": "property", "scope": "NotesStoreImpl", "scopeKind": "class"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^      const n = await APIClient.getNote(id);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const n = await APIClient.createNote(data);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "optimisticFav", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const optimisticFav = !currentFav;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "page", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  page?: number;$/", "language": "TypeScript", "kind": "property", "scope": "NotesQuery", "scopeKind": "interface"}, {"_type": "tag", "name": "pageSize", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  pageSize?: number;$/", "language": "TypeScript", "kind": "property", "scope": "NotesQuery", "scopeKind": "interface"}, {"_type": "tag", "name": "resp", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^      const resp = await APIClient.listNotes(params);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "sameQuery", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const sameQuery =$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "search", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  search?: string;$/", "language": "TypeScript", "kind": "property", "scope": "NotesQuery", "scopeKind": "interface"}, {"_type": "tag", "name": "selected", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  selected?: Note;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "selectedError", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  selectedError?: string;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "selectedId", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const selectedId = this.state.selectedId;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "selectedId", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  selectedId?: string;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "selectedLoading", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  selectedLoading: boolean;$/", "language": "TypeScript", "kind": "property", "scope": "NotesState", "scopeKind": "interface"}, {"_type": "tag", "name": "state", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  private state: NotesState = {$/", "language": "TypeScript", "kind": "property", "scope": "NotesStoreImpl", "scopeKind": "class"}, {"_type": "tag", "name": "tag", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^  tag?: string;$/", "language": "TypeScript", "kind": "property", "scope": "NotesQuery", "scopeKind": "interface"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/personal-notes-manager-37319-37355/notes_app_frontend/src/lib/store.ts", "pattern": "/^    const updated = await APIClient.patchNote(id, data);$/", "language": "TypeScript", "kind": "constant"}], "hash": "fff26e108efb1de2e2e74d4fdcaa38d8", "format-version": 4, "code-base-name": "notes_app_frontend", "filename": "notes_app_frontend/src/lib/store.ts", "fields": [{"name": "interface NotesQuery {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "interface NotesState {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "favorite?: boolean;", "scope": "NotesQuery", "scopeKind": "interface", "description": "unavailable"}, {"name": "list?: Paginated<Note>;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "listError?: string;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "listLoading: boolean;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "listParams?: NotesQuery;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "private listeners = new Set<Listener>();", "scope": "NotesStoreImpl", "scopeKind": "class", "description": "unavailable"}, {"name": "page?: number;", "scope": "NotesQuery", "scopeKind": "interface", "description": "unavailable"}, {"name": "pageSize?: number;", "scope": "NotesQuery", "scopeKind": "interface", "description": "unavailable"}, {"name": "search?: string;", "scope": "NotesQuery", "scopeKind": "interface", "description": "unavailable"}, {"name": "selected?: Note;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "selectedError?: string;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "selectedId?: string;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "selectedLoading: boolean;", "scope": "NotesState", "scopeKind": "interface", "description": "unavailable"}, {"name": "private state: NotesState = {", "scope": "NotesStoreImpl", "scopeKind": "class", "description": "unavailable"}, {"name": "tag?: string;", "scope": "NotesQuery", "scopeKind": "interface", "description": "unavailable"}]}